<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de Gestión Antología Box23 - Gestión integral de gimnasio">
    <title>Antología Box23 - Sistema de Gestión</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - Fuentes distintivas -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-3">Cargando datos...</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" aria-label="Antología Box23">
                <i class="fas fa-dumbbell me-2"></i>
                <span>Antología Box23</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button class="btn btn-outline-light me-2" id="backupBtn" aria-label="Respaldar datos">
                            <i class="fas fa-cloud-upload-alt me-1"></i> Respaldar
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-light me-2" id="restoreBtn" aria-label="Restaurar datos">
                            <i class="fas fa-cloud-download-alt me-1"></i> Restaurar
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-light" id="themeToggle" aria-label="Cambiar tema">
                            <i class="fas fa-moon"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container-fluid py-4">
        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" 
                        data-bs-target="#dashboard" type="button" role="tab" 
                        aria-controls="dashboard" aria-selected="true">
                    <i class="fas fa-chart-line me-2"></i>Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="users-tab" data-bs-toggle="tab" 
                        data-bs-target="#users" type="button" role="tab" 
                        aria-controls="users" aria-selected="false">
                    <i class="fas fa-users me-2"></i>Usuarios
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="attendance-tab" data-bs-toggle="tab" 
                        data-bs-target="#attendance" type="button" role="tab" 
                        aria-controls="attendance" aria-selected="false">
                    <i class="fas fa-clipboard-check me-2"></i>Asistencia
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="income-tab" data-bs-toggle="tab" 
                        data-bs-target="#income" type="button" role="tab" 
                        aria-controls="income" aria-selected="false">
                    <i class="fas fa-dollar-sign me-2"></i>Pagos
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="finance-tab" data-bs-toggle="tab"
                        data-bs-target="#finance" type="button" role="tab">
                    <i class="fas fa-wallet me-2"></i>Finanzas
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="staff-tab" data-bs-toggle="tab"
                        data-bs-target="#staff" type="button" role="tab">
                    <i class="fas fa-chalkboard-teacher me-2"></i>Personal
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link position-relative" id="whatsapp-tab" data-bs-toggle="tab"
                        data-bs-target="#whatsapp" type="button" role="tab">
                    <i class="fab fa-whatsapp me-2"></i>WhatsApp
                    <span id="birthdayBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display:none;font-size:.6rem">0</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reports-tab" data-bs-toggle="tab" 
                        data-bs-target="#reports" type="button" role="tab">
                    <i class="fas fa-file-alt me-2"></i>Reportes
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" 
                        data-bs-target="#settings" type="button" role="tab">
                    <i class="fas fa-cog me-2"></i>Configuración
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                <div class="row g-4">
                    <!-- Summary Cards -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stats-card" data-animate="fade-up">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-muted mb-2">Usuarios Activos</h6>
                                        <h2 class="mb-0" id="activeUsersCount">0</h2>
                                    </div>
                                    <div class="stats-icon bg-primary">
                                        <i class="fas fa-users"></i>
                                    </div>
                                </div>
                                <small class="text-muted" id="activeUsersChange">Sin cambios</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="card stats-card" data-animate="fade-up" style="animation-delay: 0.1s">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-muted mb-2">Ingresos del Mes</h6>
                                        <h2 class="mb-0" id="monthlyIncome">$0</h2>
                                    </div>
                                    <div class="stats-icon bg-success">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                </div>
                                <small class="text-muted" id="monthlyIncomeChange">Sin cambios</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="card stats-card" data-animate="fade-up" style="animation-delay: 0.2s">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-muted mb-2">Asistencia Hoy</h6>
                                        <h2 class="mb-0" id="todayAttendance">0</h2>
                                    </div>
                                    <div class="stats-icon bg-info">
                                        <i class="fas fa-clipboard-check"></i>
                                    </div>
                                </div>
                                <small class="text-muted" id="todayAttendanceRate">0% de ocupación</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="card stats-card" data-animate="fade-up" style="animation-delay: 0.3s">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-muted mb-2">Pagos Pendientes</h6>
                                        <h2 class="mb-0" id="pendingPayments">0</h2>
                                    </div>
                                    <div class="stats-icon bg-warning">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                </div>
                                <small class="text-muted" id="pendingPaymentsAmount">$0 pendientes</small>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="col-lg-8">
                        <div class="card" data-animate="fade-up" style="animation-delay: 0.4s">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Ingresos Mensuales</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="incomeChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card" data-animate="fade-up" style="animation-delay: 0.5s">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Tipos de Membresía</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="membershipChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="col-lg-6">
                        <div class="card" data-animate="fade-up" style="animation-delay: 0.6s">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Acciones Rápidas</h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-6">
                                        <button class="btn btn-primary w-100" id="quickAddUser">
                                            <i class="fas fa-user-plus me-2"></i>Nuevo Usuario
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-success w-100" id="quickAddPayment">
                                            <i class="fas fa-hand-holding-usd me-2"></i>Registrar Pago
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-info w-100" id="quickAttendance">
                                            <i class="fas fa-clipboard-check me-2"></i>Asistencia
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-warning w-100" id="quickReport">
                                            <i class="fas fa-file-export me-2"></i>Exportar Reporte
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="col-lg-6">
                        <div class="card" data-animate="fade-up" style="animation-delay: 0.7s">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-history me-2"></i>Actividad Reciente</h5>
                            </div>
                            <div class="card-body">
                                <div id="recentActivity" class="activity-list">
                                    <!-- Se llenará dinámicamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-users me-2"></i>Gestión de Usuarios</h5>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#userModal" id="addUserBtn">
                            <i class="fas fa-user-plus me-2"></i>Agregar Usuario
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Search and Filters -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="userSearch" 
                                           placeholder="Buscar por nombre, email o teléfono...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="statusFilter">
                                    <option value="">Todos los estados</option>
                                    <option value="active">Activos</option>
                                    <option value="inactive">Inactivos</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="affiliationFilter">
                                    <option value="">Todas las afiliaciones</option>
                                    <option value="Mensualidad">Mensualidad</option>
                                    <option value="Paquete 10 clases">Paquete 10 clases</option>
                                    <option value="Personalizado Diana">Personalizado Diana</option>
                                    <option value="Clase suelta">Clase suelta</option>
                                    <option value="GAP">GAP</option>
                                    <option value="FLEX">FLEX</option>
                                    <option value="Entrenador(a)">Entrenador(a)</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-secondary w-100" id="clearFilters">
                                    <i class="fas fa-times me-1"></i>Limpiar
                                </button>
                            </div>
                        </div>

                        <!-- Users Table -->
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead>
                                    <tr>
                                        <th style="width:40px">#</th>
                                        <th>Nombre</th>
                                        <th>Documento</th>
                                        <th>Teléfono</th>
                                        <th>EPS</th>
                                        <th>RH</th>
                                        <th>Clase</th>
                                        <th>Afiliación</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="usersList">
                                    <!-- Se llenará dinámicamente -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Paginación de usuarios">
                            <ul class="pagination justify-content-center" id="usersPagination">
                                <!-- Se generará dinámicamente -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Attendance Tab -->
                        <!-- Asistencia Tab -->
            <div class="tab-pane fade" id="attendance" role="tabpanel" aria-labelledby="attendance-tab">

                <!-- Tabla de asistencia del día -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <h5 class="mb-0"><i class="fas fa-clipboard-check me-2"></i>Asistencia del Día</h5>
                        <div class="d-flex align-items-center gap-2 flex-wrap">
                            <span id="attendanceDaySummary"></span>
                            <input type="date" class="form-control form-control-sm" id="attendanceDate" style="width:160px">
                            <input type="text" class="form-control form-control-sm" id="attendanceSearch" placeholder="Buscar usuario..." style="width:180px">
                            <button class="btn btn-sm btn-success" id="markAllPresent">
                                <i class="fas fa-check-double me-1"></i>Marcar todos presentes
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Usuario</th>
                                        <th>Estado</th>
                                        <th>Vigencia del Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceList">
                                    <tr><td colspan="5" class="text-center py-4 text-muted">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Alertas de inasistencia -->
                <div class="card mb-4 border-warning">
                    <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-warning"><i class="fas fa-exclamation-triangle me-2"></i>Alertas de Inasistencia <span class="badge bg-warning text-dark" id="alertsCount">0</span></h5>
                        <small class="text-muted">Usuarios activos sin asistir más de 6 días</small>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-sm mb-0">
                                <thead><tr><th>#</th><th>Usuario</th><th>Estado</th><th>Última asistencia</th><th>WhatsApp</th></tr></thead>
                                <tbody id="alertsList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Informe de asistencia por período -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Informe de Asistencia</h5>
                        <span class="badge bg-primary" id="reportSummary">0 asistencias</span>
                    </div>
                    <div class="card-body">
                        <div class="row g-2 mb-3">
                            <div class="col-md-3">
                                <label class="form-label small">Fecha inicial</label>
                                <input type="date" class="form-control form-control-sm" id="reportDateFrom">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label small">Fecha final</label>
                                <input type="date" class="form-control form-control-sm" id="reportDateTo">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Usuario</label>
                                <select class="form-select form-select-sm" id="reportUser">
                                    <option value="">Todos los usuarios</option>
                                </select>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button class="btn btn-primary btn-sm w-100" id="applyAttendanceReport">
                                    <i class="fas fa-search me-1"></i>Consultar
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm mb-0">
                                <thead><tr><th>#</th><th>Fecha</th><th>Usuario</th><th>Hora</th></tr></thead>
                                <tbody id="reportList">
                                    <tr><td colspan="4" class="text-center py-3 text-muted">Selecciona un rango de fechas</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>

<div class="tab-pane fade" id="income" role="tabpanel" aria-labelledby="income-tab">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-dollar-sign me-2"></i>Gestión de Pagos</h5>
                        <button class="btn btn-primary" id="addIncomeBtn" onclick="Income.openModal()">
                            <i class="fas fa-plus me-2"></i>Registrar Pago
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Filters -->
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <input type="date" class="form-control" id="paymentDateFrom" 
                                       placeholder="Fecha desde">
                            </div>
                            <div class="col-md-3">
                                <input type="date" class="form-control" id="paymentDateTo" 
                                       placeholder="Fecha hasta">
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="paymentTypeFilter">
                                        <option value="">Todos los tipos</option>
                                        <option value="Mensualidad">Mensualidad</option>
                                        <option value="Paquete 10 clases">Paquete 10 clases</option>
                                        <option value="Personalizado Diana">Personalizado Diana</option>
                                        <option value="Clase suelta">Clase suelta</option>
                                        <option value="Movimientos caja">Movimientos caja</option>
                                    </select>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary w-100" id="applyPaymentFilters">
                                    <i class="fas fa-filter me-2"></i>Filtrar
                                </button>
                            </div>
                        </div>

                        <!-- Income Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Fecha</th>
                                        <th>Usuario</th>
                                        <th>Tipo</th>
                                        <th>Monto</th>
                                        <th>Método</th>
                                        <th>Vigencia</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="incomeList">
                                    <!-- Se llenará dinámicamente -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Paginación de pagos">
                            <ul class="pagination justify-content-center" id="incomePagination">
                                <!-- Se generará dinámicamente -->
                            </ul>
                        </nav>

                        <!-- Summary -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <h6>Total del Período</h6>
                                        <h3 id="periodTotal">$0.00</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-info text-white">
                                    <div class="card-body">
                                        <h6>Número de Transacciones</h6>
                                        <h3 id="periodCount">0</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Finanzas Tab -->
            <div class="tab-pane fade" id="finance" role="tabpanel">
                <!-- Saldos por cuenta -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-wallet me-2"></i>Saldos por Cuenta</h5>
                        <div>Total: <strong id="totalBalance">$ 0</strong></div>
                    </div>
                    <div class="card-body">
                        <div class="row g-3" id="accountBalances">
                            <div class="text-center text-muted py-3">Cargando saldos...</div>
                        </div>
                    </div>
                </div>

                <!-- Registrar gasto -->
                <div class="card mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-minus-circle me-2 text-danger"></i>Registrar Gasto</h5></div>
                    <div class="card-body">
                        <form id="expenseForm">
                            <div class="row g-3">
                                <div class="col-md-2">
                                    <label class="form-label small">Fecha *</label>
                                    <input type="date" class="form-control form-control-sm" id="expenseDate" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Descripción *</label>
                                    <input type="text" class="form-control form-control-sm" id="expenseDesc" placeholder="Descripción del gasto" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Monto *</label>
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="expenseAmount" min="0" required>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Categoría *</label>
                                    <select class="form-select form-select-sm" id="expenseCategory" required>
                                        <option value="">Seleccionar...</option>
                                        <option>Nomina</option><option>Arriendo</option>
                                        <option>Servicios públicos</option><option>Mantenimiento</option>
                                        <option>Insumos</option><option>Marketing</option>
                                        <option>Impuestos</option><option>Otros</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Cuenta *</label>
                                    <select class="form-select form-select-sm" id="expenseAccount" required>
                                        <option value="">Seleccionar...</option>
                                        <option>Efectivo</option><option>Bancolombia</option>
                                        <option>Daviplata</option><option>Nequi</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <button type="button" class="btn btn-danger btn-sm" id="saveExpenseBtn">
                                        <i class="fas fa-save me-1"></i>Guardar Gasto
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Historial de gastos -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-history me-2"></i>Historial de Gastos</h5>
                        <span>Total: <strong id="expensesTotal">$ 0</strong></span>
                    </div>
                    <div class="card-body">
                        <div class="row g-2 mb-3">
                            <div class="col-md-2"><label class="form-label small">Desde</label><input type="date" class="form-control form-control-sm" id="expHistFrom"></div>
                            <div class="col-md-2"><label class="form-label small">Hasta</label><input type="date" class="form-control form-control-sm" id="expHistTo"></div>
                            <div class="col-md-3">
                                <label class="form-label small">Categoría</label>
                                <select class="form-select form-select-sm" id="expHistCategory">
                                    <option value="">Todas</option>
                                    <option>Nomina</option><option>Arriendo</option>
                                    <option>Servicios públicos</option><option>Mantenimiento</option>
                                    <option>Insumos</option><option>Marketing</option>
                                    <option>Impuestos</option><option>Otros</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label small">Cuenta</label>
                                <select class="form-select form-select-sm" id="expHistAccount">
                                    <option value="">Todas</option>
                                    <option>Efectivo</option><option>Bancolombia</option>
                                    <option>Daviplata</option><option>Nequi</option>
                                </select>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button class="btn btn-primary btn-sm w-100" id="applyExpHistFilter">
                                    <i class="fas fa-search me-1"></i>Filtrar
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover mb-0">
                                <thead><tr><th>#</th><th>Fecha</th><th>Descripción</th><th>Categoría</th><th>Cuenta</th><th>Monto</th><th></th></tr></thead>
                                <tbody id="expensesList"><tr><td colspan="7" class="text-center text-muted py-3">Sin gastos</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Reporte financiero -->
                <div class="card">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Reporte Financiero</h5></div>
                    <div class="card-body">
                        <div class="row g-2 mb-4 align-items-end">
                            <div class="col-md-3"><label class="form-label small">Desde</label><input type="date" class="form-control form-control-sm" id="finRepFrom"></div>
                            <div class="col-md-3"><label class="form-label small">Hasta</label><input type="date" class="form-control form-control-sm" id="finRepTo"></div>
                            <div class="col-md-2"><button class="btn btn-primary btn-sm w-100" id="applyFinReport"><i class="fas fa-sync me-1"></i>Calcular</button></div>
                        </div>
                        <div class="row g-3 mb-4">
                            <div class="col-6 col-md-3">
                                <div class="card text-center bg-success bg-opacity-10">
                                    <div class="card-body py-3">
                                        <div class="text-muted small">Ingresos</div>
                                        <div class="fs-5 fw-bold text-success" id="finRepIncome">$ 0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="card text-center bg-danger bg-opacity-10">
                                    <div class="card-body py-3">
                                        <div class="text-muted small">Gastos</div>
                                        <div class="fs-5 fw-bold text-danger" id="finRepExpenses">$ 0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="card text-center bg-primary bg-opacity-10">
                                    <div class="card-body py-3">
                                        <div class="text-muted small">Utilidad Neta</div>
                                        <div class="fs-5 fw-bold" id="finRepProfit">$ 0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="card text-center bg-info bg-opacity-10">
                                    <div class="card-body py-3">
                                        <div class="text-muted small">Margen de Utilidad</div>
                                        <div class="fs-5 fw-bold" id="finRepMargin">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h6 class="text-muted mb-2">Gastos por categoría</h6>
                        <div id="finRepCategories"></div>
                    </div>
                </div>
            </div>

            <!-- Personal Tab -->
            <div class="tab-pane fade" id="staff" role="tabpanel">
                <!-- Registrar clase -->
                <div class="card mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-chalkboard-teacher me-2"></i>Registrar Clase Dictada</h5></div>
                    <div class="card-body">
                        <form id="classForm">
                            <div class="row g-3">
                                <div class="col-md-2">
                                    <label class="form-label small">Fecha *</label>
                                    <input type="date" class="form-control form-control-sm" id="classDate" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Hora *</label>
                                    <select class="form-select form-select-sm" id="classHour" required>
                                        <option value="">Seleccionar...</option>
                                        <option>5:00 AM</option><option>6:00 AM</option>
                                        <option>7:00 AM</option><option>8:00 AM</option>
                                        <option>9:00 AM</option><option>4:00 PM</option>
                                        <option>5:30 PM</option><option>6:30 PM</option>
                                        <option>7:30 PM</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label small">Entrenador *</label>
                                    <select class="form-select form-select-sm" id="classTrainer" required>
                                        <option value="">Seleccionar...</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Tipo de Clase *</label>
                                    <select class="form-select form-select-sm" id="classType" required>
                                        <option value="">Seleccionar...</option>
                                        <option>Crossfit</option><option>GAP</option>
                                        <option>FLEX</option><option>Personalizado</option>
                                        <option>Mantenimiento</option><option>Otro</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Duración *</label>
                                    <select class="form-select form-select-sm" id="classDuration" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="1">1 hora</option>
                                        <option value="1.5">1.5 horas</option>
                                        <option value="2">2 horas</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <button type="button" class="btn btn-primary btn-sm" id="saveClassBtn">
                                        <i class="fas fa-save me-1"></i>Registrar Clase · <span class="small">$8.500/hora</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Historial de clases -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <h5 class="mb-0"><i class="fas fa-history me-2"></i>Historial de Clases</h5>
                        <div class="d-flex gap-3">
                            <span class="text-muted small">Horas: <strong id="staffTotalHours">0 h</strong></span>
                            <span class="text-muted small">Total a pagar: <strong id="staffTotalPay">$ 0</strong></span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2 mb-3">
                            <div class="col-md-3"><label class="form-label small">Desde</label><input type="date" class="form-control form-control-sm" id="staffHistFrom"></div>
                            <div class="col-md-3"><label class="form-label small">Hasta</label><input type="date" class="form-control form-control-sm" id="staffHistTo"></div>
                            <div class="col-md-3">
                                <label class="form-label small">Entrenador</label>
                                <select class="form-select form-select-sm" id="staffHistTrainer"><option value="">Todos</option></select>
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <button class="btn btn-primary btn-sm w-100" id="applyStaffFilter">
                                    <i class="fas fa-search me-1"></i>Filtrar
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover mb-0">
                                <thead><tr><th>#</th><th>Fecha</th><th>Hora</th><th>Entrenador</th><th>Tipo</th><th>Duración</th><th>Pago</th><th></th></tr></thead>
                                <tbody id="classesList"><tr><td colspan="8" class="text-center text-muted py-3">Sin clases registradas</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WhatsApp Tab -->
            <div class="tab-pane fade" id="whatsapp" role="tabpanel">
                <!-- Cumpleaños del día -->
                <div class="card mb-4 border-warning">
                    <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-birthday-cake me-2 text-warning"></i>Cumpleaños de Hoy</h5>
                        <button class="btn btn-sm btn-outline-warning" id="waBirthdayCheck">
                            <i class="fas fa-sync me-1"></i>Verificar
                        </button>
                    </div>
                    <div class="card-body" id="birthdayList">
                        <p class="text-muted text-center py-2">Haz clic en "Verificar" para revisar cumpleaños</p>
                    </div>
                </div>

                <!-- Mensajes por usuario -->
                <div class="card">
                    <div class="card-header"><h5 class="mb-0"><i class="fab fa-whatsapp me-2 text-success"></i>Mensajes por Usuario</h5></div>
                    <div class="card-body">
                        <div class="mb-3 p-3 bg-light rounded small">
                            <strong>Botones disponibles por usuario:</strong>
                            <span class="badge bg-success ms-2"><i class="fas fa-hand-wave me-1"></i>Bienvenida + invitación grupo</span>
                            <span class="badge bg-info ms-2"><i class="fas fa-bell me-1"></i>Recordatorio pago</span>
                            <span class="badge bg-warning text-dark ms-2"><i class="fas fa-user-clock me-1"></i>Recordatorio inasistencia</span>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover mb-0">
                                <thead><tr><th>#</th><th>Nombre</th><th>Teléfono</th><th>Último pago</th><th>Mensajes</th></tr></thead>
                                <tbody id="waUsersList"><tr><td colspan="5" class="text-center text-muted py-3">Cargando...</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="reports-tab">
                <div class="row g-4">
                    <!-- Attendance Report -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Reporte de Asistencia</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="attendanceReportMonth" class="form-label">Seleccionar Mes</label>
                                    <input type="month" class="form-control" id="attendanceReportMonth">
                                </div>
                                <button class="btn btn-primary w-100 mb-3" id="generateAttendanceReport">
                                    <i class="fas fa-chart-line me-2"></i>Generar Reporte
                                </button>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Usuario</th>
                                                <th>Asistencias</th>
                                                <th>%</th>
                                            </tr>
                                        </thead>
                                        <tbody id="attendanceReportList">
                                            <tr>
                                                <td colspan="3" class="text-center text-muted">
                                                    Selecciona un mes y genera el reporte
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <button class="btn btn-success w-100" id="exportAttendanceReportExcel">
                                    <i class="fas fa-file-excel me-2"></i>Exportar a Excel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Income Report -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-dollar-sign me-2"></i>Reporte de Ingresos</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="incomeReportMonth" class="form-label">Seleccionar Mes</label>
                                    <input type="month" class="form-control" id="incomeReportMonth">
                                </div>
                                <button class="btn btn-primary w-100 mb-3" id="generateIncomeReport">
                                    <i class="fas fa-chart-pie me-2"></i>Generar Reporte
                                </button>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Tipo</th>
                                                <th>Cantidad</th>
                                                <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody id="incomeReportList">
                                            <tr>
                                                <td colspan="3" class="text-center text-muted">
                                                    Selecciona un mes y genera el reporte
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <button class="btn btn-success w-100" id="exportIncomeReportExcel">
                                    <i class="fas fa-file-excel me-2"></i>Exportar a Excel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Report -->
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Reporte Personalizado</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Fecha Inicio</label>
                                        <input type="date" class="form-control" id="customReportStart">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Fecha Fin</label>
                                        <input type="date" class="form-control" id="customReportEnd">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Tipo de Reporte</label>
                                        <select class="form-select" id="customReportType">
                                            <option value="complete">Completo</option>
                                            <option value="attendance">Solo Asistencia</option>
                                            <option value="income">Solo Ingresos</option>
                                            <option value="users">Solo Usuarios</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <button class="btn btn-primary" id="generateCustomReport">
                                        <i class="fas fa-cogs me-2"></i>Generar Reporte
                                    </button>
                                    <button class="btn btn-success" id="exportCustomReportPDF">
                                        <i class="fas fa-file-pdf me-2"></i>Exportar PDF
                                    </button>
                                    <button class="btn btn-success" id="exportCustomReportExcel">
                                        <i class="fas fa-file-excel me-2"></i>Exportar Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                <div class="row g-4">
                    <!-- Backup Settings -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-database me-2"></i>Respaldo de Datos</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Gestiona los respaldos de tu información</p>
                                <div class="mb-3">
                                    <label class="form-label">Respaldo Automático</label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="autoBackupToggle">
                                        <label class="form-check-label" for="autoBackupToggle">
                                            Activar respaldo automático diario
                                        </label>
                                    </div>
                                </div>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" id="manualBackup">
                                        <i class="fas fa-download me-2"></i>Descargar Respaldo
                                    </button>
                                    <button class="btn btn-secondary" id="importBackup">
                                        <i class="fas fa-upload me-2"></i>Importar Respaldo
                                    </button>
                                </div>
                                <input type="file" id="backupFileInput" class="d-none" accept=".json">
                                <hr>
                                <small class="text-muted">
                                    Último respaldo: <span id="lastBackupDate">Nunca</span>
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- System Settings -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-sliders-h me-2"></i>Configuración del Sistema</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Tema de Color</label>
                                    <select class="form-select" id="themeSelect">
                                        <option value="dark">Oscuro</option>
                                        <option value="light">Claro</option>
                                        <option value="auto">Automático</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Registros por Página</label>
                                    <select class="form-select" id="itemsPerPage">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Notificaciones</label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="notificationsToggle" checked>
                                        <label class="form-check-label" for="notificationsToggle">
                                            Mostrar notificaciones
                                        </label>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100" id="saveSettings">
                                    <i class="fas fa-save me-2"></i>Guardar Configuración
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Data Management -->
                    <div class="col-12">
                        <div class="card border-danger">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Zona de Peligro</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Estas acciones son irreversibles. Úsalas con precaución.</p>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-danger" id="clearAllData">
                                        <i class="fas fa-trash me-2"></i>Eliminar Todos los Datos
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">
                        <i class="fas fa-user-plus me-2"></i>Agregar Usuario
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <input type="hidden" id="userId">
                        <div class="row">

                            <!-- Fila 1: Nombre + Documento -->
                            <div class="col-md-6 mb-3">
                                <label for="userName" class="form-label">Nombre Completo *</label>
                                <input type="text" class="form-control" id="userName"
                                       placeholder="Ej: Juan Pérez" required>
                                <div class="invalid-feedback">Ingresa el nombre completo (mín. 3 caracteres).</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userDocument" class="form-label">Documento *</label>
                                <input type="text" class="form-control" id="userDocument"
                                       placeholder="Ej: 1234567890" required>
                                <div class="invalid-feedback">Ingresa el número de documento.</div>
                            </div>

                            <!-- Fila 2: Fecha Nacimiento + Teléfono -->
                            <div class="col-md-6 mb-3">
                                <label for="userBirthdate" class="form-label">Fecha de Nacimiento *</label>
                                <input type="date" class="form-control" id="userBirthdate" required>
                                <div class="invalid-feedback">Selecciona la fecha de nacimiento.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userPhone" class="form-label">Teléfono *</label>
                                <input type="tel" class="form-control" id="userPhone"
                                       placeholder="10 dígitos" required>
                                <div class="invalid-feedback">Ingresa un teléfono de 10 dígitos.</div>
                            </div>

                            <!-- Fila 3: EPS + RH -->
                            <div class="col-md-6 mb-3">
                                <label for="userEps" class="form-label">EPS</label>
                                <input type="text" class="form-control" id="userEps"
                                       placeholder="Ej: Sura, Compensar...">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userBloodType" class="form-label">RH (Grupo Sanguíneo)</label>
                                <select class="form-select" id="userBloodType">
                                    <option value="">Seleccionar...</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                </select>
                            </div>

                            <!-- Fila 4: Patología (ancho completo) -->
                            <div class="col-12 mb-3">
                                <label for="userPathology" class="form-label">Patología / Condición médica</label>
                                <input type="text" class="form-control" id="userPathology"
                                       placeholder="Ej: Hipertensión, Diabetes, Ninguna...">
                            </div>

                            <!-- Fila 5: Contacto Emergencia + Teléfono Emergencia -->
                            <div class="col-md-6 mb-3">
                                <label for="userEmergencyContact" class="form-label">Contacto de Emergencia *</label>
                                <input type="text" class="form-control" id="userEmergencyContact"
                                       placeholder="Nombre del contacto" required>
                                <div class="invalid-feedback">Ingresa el nombre del contacto de emergencia.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userEmergencyPhone" class="form-label">Teléfono Emergencia *</label>
                                <input type="tel" class="form-control" id="userEmergencyPhone"
                                       placeholder="10 dígitos" required>
                                <div class="invalid-feedback">Ingresa el teléfono de emergencia.</div>
                            </div>

                            <!-- Fila 6: Clase + Tipo Afiliación -->
                            <div class="col-md-6 mb-3">
                                <label for="userClassTime" class="form-label">Clase (Horario) *</label>
                                <select class="form-select" id="userClassTime" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="5:00 AM">5:00 AM</option>
                                    <option value="6:00 AM">6:00 AM</option>
                                    <option value="7:00 AM">7:00 AM</option>
                                    <option value="8:00 AM">8:00 AM</option>
                                    <option value="9:00 AM">9:00 AM</option>
                                    <option value="4:00 PM">4:00 PM</option>
                                    <option value="5:30 PM">5:30 PM</option>
                                    <option value="6:30 PM">6:30 PM</option>
                                    <option value="7:30 PM">7:30 PM</option>
                                </select>
                                <div class="invalid-feedback">Selecciona un horario.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userAffiliation" class="form-label">Tipo de Afiliación *</label>
                                <select class="form-select" id="userAffiliation" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Mensualidad">Mensualidad</option>
                                    <option value="Paquete 10 clases">Paquete 10 clases</option>
                                    <option value="Personalizado Diana">Personalizado Diana</option>
                                    <option value="Clase suelta">Clase suelta</option>
                                    <option value="GAP">GAP</option>
                                    <option value="FLEX">FLEX</option>
                                    <option value="Entrenador(a)">Entrenador(a)</option>
                                </select>
                                <div class="invalid-feedback">Selecciona un tipo de afiliación.</div>
                            </div>

                            <!-- Fila 7: Estado -->
                            <div class="col-md-6 mb-3">
                                <label for="userStatus" class="form-label">Estado *</label>
                                <select class="form-select" id="userStatus" required>
                                    <option value="active">Activo</option>
                                    <option value="inactive">Inactivo</option>
                                </select>
                            </div>

                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" id="saveUserBtn">
                        <i class="fas fa-save me-2"></i>Guardar Usuario
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Income Modal -->
    <div class="modal fade" id="incomeModal" tabindex="-1" aria-labelledby="incomeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="incomeModalLabel">
                        <i class="fas fa-dollar-sign me-2"></i>Registrar Pago
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="incomeForm">
                        <input type="hidden" id="incomeId">
                        <div class="mb-3">
                            <label for="incomeUser" class="form-label">Usuario *</label>
                            <select class="form-select" id="incomeUser" required>
                                <option value="">Seleccionar usuario...</option>
                            </select>
                            <div class="invalid-feedback">Por favor selecciona un usuario.</div>
                        </div>
                        <div class="mb-3">
                            <label for="incomeType" class="form-label">Tipo de Pago *</label>
                            <select class="form-select" id="incomeType" required>
                                <option value="">Seleccionar...</option>
                                <option value="Mensualidad">Mensualidad</option>
                                <option value="Paquete 10 clases">Paquete 10 clases</option>
                                <option value="Personalizado Diana">Personalizado Diana</option>
                                <option value="Clase suelta">Clase suelta</option>
                                <option value="Movimientos caja">Movimientos caja</option>
                            </select>
                            <div class="invalid-feedback">Por favor selecciona un tipo de pago.</div>
                        </div>
                        <div class="mb-3">
                            <label for="incomeAmount" class="form-label">Monto *</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="incomeAmount" 
                                       step="0.01" min="0" required>
                            </div>
                            <div class="invalid-feedback">Por favor ingresa un monto válido mayor a 0.</div>
                        </div>
                        <div class="mb-3">
                            <label for="incomeMethod" class="form-label">Método de Pago *</label>
                            <select class="form-select" id="incomeMethod" required>
                                <option value="">Seleccionar...</option>
                                <option value="Efectivo">Efectivo</option>
                                <option value="Bancolombia">Bancolombia</option>
                                <option value="Daviplata">Daviplata</option>
                                <option value="Nequi">Nequi</option>
                            </select>
                            <div class="invalid-feedback">Por favor selecciona un método de pago.</div>
                        </div>
                        <div class="mb-3">
                            <label for="incomeDate" class="form-label">Fecha de Pago *</label>
                            <input type="date" class="form-control" id="incomeDate" required>
                            <div class="invalid-feedback">Por favor selecciona una fecha.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-calendar-alt me-1 text-primary"></i>Vigencia del Pago
                            </label>
                            <div class="row g-2">
                                <div class="col-6">
                                    <label for="incomeStartDate" class="form-label small text-muted mb-1">Desde</label>
                                    <input type="date" class="form-control" id="incomeStartDate" required>
                                    <div class="invalid-feedback">Selecciona fecha de inicio.</div>
                                </div>
                                <div class="col-6">
                                    <label for="incomeEndDate" class="form-label small text-muted mb-1">Hasta</label>
                                    <input type="date" class="form-control" id="incomeEndDate" required>
                                    <div class="invalid-feedback">Selecciona fecha de fin.</div>
                                </div>
                            </div>
                            <div id="vigenciaInfo" class="form-text text-success mt-1" style="display:none"></div>
                        </div>
                        <div class="mb-3">
                            <label for="incomeNotes" class="form-label">Notas</label>
                            <textarea class="form-control" id="incomeNotes" rows="2" 
                                      placeholder="Información adicional del pago..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" id="saveIncomeBtn">
                        <i class="fas fa-save me-2"></i>Guardar Pago
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirmar Acción
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirmModalBody">
                    ¿Estás seguro de realizar esta acción?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmActionBtn">
                        <i class="fas fa-check me-2"></i>Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/users.js"></script>
    <script src="js/attendance.js"></script>
    <script src="js/income.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/backup.js"></script>
    <!-- Modal Editar Gasto -->
    <div class="modal fade" id="editExpenseModal" tabindex="-1" aria-labelledby="editExpenseModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editExpenseModalLabel">
                        <i class="fas fa-edit me-2"></i>Editar Gasto
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editExpenseForm">
                        <input type="hidden" id="editExpenseId">
                        <div class="mb-3">
                            <label class="form-label">Fecha *</label>
                            <input type="date" class="form-control" id="editExpenseDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripción *</label>
                            <input type="text" class="form-control" id="editExpenseDesc" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Monto *</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="editExpenseAmount" min="0" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Categoría *</label>
                            <select class="form-select" id="editExpenseCategory" required>
                                <option value="">Seleccionar...</option>
                                <option>Nomina</option><option>Arriendo</option>
                                <option>Servicios públicos</option><option>Mantenimiento</option>
                                <option>Insumos</option><option>Marketing</option>
                                <option>Impuestos</option><option>Otros</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Cuenta *</label>
                            <select class="form-select" id="editExpenseAccount" required>
                                <option value="">Seleccionar...</option>
                                <option>Efectivo</option><option>Bancolombia</option>
                                <option>Daviplata</option><option>Nequi</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" id="saveEditExpenseBtn">
                        <i class="fas fa-save me-2"></i>Guardar Cambios
                    </button>
                </div>
            </div>
        </div>
    </div>

        <script src="js/finance.js"></script>
    <script src="js/staff.js"></script>
    <script src="js/whatsapp.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
